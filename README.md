# # ショップ管理アプリケーション

## プロジェクト概要

本プロジェクトは、ユーザーが主体的に店舗情報を登録・管理・共有できるWebアプリケーションです。オンライン上での地域密着型店舗の情報を活性化させることを目的としています。店舗の登録、編集、削除、そして簡易的なシェア機能を提供することで、ユーザーは常に最新の情報を共有し、地域の交流を促進できます。

## 主要機能

* **店舗一覧**: 登録されているすべての店舗情報を一覧で表示します。
* **店舗詳細**: 各店舗の詳細情報（店舗名、評価、説明、サイトURLなど）を確認できます。
* **店舗登録/編集**: 新規店舗の登録、または既存店舗情報の編集が可能です。
* **簡易シェア機能**: 店舗詳細画面のURLを簡単にコピーし、SNSなどで共有できます。

## 使用技術

### フロントエンド
* **Next.js**: Reactベースのフレームワーク。サーバーサイドレンダリング（SSR）による高速な初期表示とSEO対策を実現。
* **React**: UIコンポーネントの構築に使用。
* **Axios**: バックエンドとの非同期通信に使用。
* **Material UI**: Googleのマテリアルデザインに基づいたUIコンポーネントライブラリ。

### バックエンド
* **Python**: シンプルで読みやすい構文を持つプログラミング言語。
* **Django REST Framework**: RESTful APIの構築に使用。
* **MySQL**: 高速で安定したリレーショナルデータベース管理システム。

### 開発環境・ツール
* **Docker**: 開発環境のコンテナ化に使用。
* **VS Code**: 軽量なソースコードエディタ。
* **MySQL Workbench**: MySQLのGUIツール。

## システム構成

本アプリケーションは、フロントエンド（Next.js）とバックエンド（Django REST Framework）によるクライアント・サーバー型の構成を採用しています。

* **フロントエンド**: ユーザーインターフェースを担い、ユーザーの操作に応じてバックエンドAPIを呼び出します。
* **バックエンド**: フロントエンドからのリクエストを受けて処理を実行し、MySQLデータベースと連携してデータの更新・削除を行います。

## APIルーティング一覧

以下は、バックエンドが提供する主要なAPIエンドポイントです。

* `/token/`: JWTアクセストークンとリフレッシュトークンの取得。
* `/token/refresh/`: リフレッシュトークンから新しいアクセストークンを取得。
* `/login/`: トークンをCookieに保存してログイン処理を実行。
* `/logout/`: Cookieからトークンを削除してログアウト処理を実行。
* `/retry/`: アクセストークン期限切れ時の再取得。
* `/products/`: 商品一覧の取得、新規登録。
* `/products/<id>/`: 特定商品の取得、更新、削除。
* `/purchases/`: 仕入情報の登録。
* `/sales/`: 売上情報の登録。
* `/inventories/<id>/`: 特定商品の在庫履歴の取得。

## データベーススキーマ

本アプリケーションは、主に以下の2つのテーブルで構成されています。

### `Shop` テーブル

店舗情報を管理するテーブル。
| カラム名 | 型 | 補足 |
| :--- | :--- | :--- |
| `id` | `AutoField` | 主キー、自動付与 |
| `image_file` | `ForeignKey` | `ImageFile`への外部キー |
| `name` | `CharField(100)` | 店舗名 |
| `value` | `IntegerField` | 評価 |
| `description` | `Textfield` | 店舗説明 |
| `cite` | `Textfield` | サイトURL |

### `ImageFile` テーブル

画像情報を管理するテーブル。
| カラム名 | 型 | 補足 |
| :--- | :--- | :--- |
| `id` | `AutoField` | 主キー、自動付与 |
| `url` | `ImageField` | 画像のファイルパス |

## セキュリティ設計

* **JWT認証**: アクセストークンとリフレッシュトークンを用いたステートレスな認証方式を採用。
* **HttpOnly Cookie**: トークンを`HttpOnly`フラグ付きのクッキーに保存し、XSS攻撃によるトークン盗難リスクを軽減。
* **ファイルアップロード検証**: アップロードはCSV形式に限定し、サーバー側で厳格なバリデーションを実行。
* **ORMの使用**: Django ORMを介してデータベースにアクセスすることで、SQLインジェクション攻撃を防止。

## エラーハンドリング

* **バリデーションエラー**: シリアライザーによる自動バリデーションで`HTTP 400 Bad Request`を返却。
* **例外処理**: `try-except`文を使用し、予期せぬ例外発生時もシステムが異常終了しないように設計。

## ログ設計

* **ロギングライブラリ**: Python標準の`logging`ライブラリを使用。
* **ログレベル**: `INFO`（通常操作）、`WARNING`（軽微な異常）、`ERROR`（致命的なエラー）を使い分けてログを出力。
* **出力先**: 開発環境では標準出力、運用環境ではファイル出力や外部サービス連携も可能。

## 今後の展望

* **複数画像アップロード機能**: 1つの店舗に複数の画像を登録できる機能を追加。
* **ユーザーレビュー機能**: ユーザーが店舗の評価やレビューを投稿できる機能を追加。
* **店舗検索機能**: 店舗名や評価、キーワードなどで絞り込み検索できる機能を追加。
* **テストの充実**: 今後の開発に備え、ユニットテストや統合テストの導入を進めます。